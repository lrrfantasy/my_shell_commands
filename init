#!/bin/sh
# Initialise a file from the template

ignore_init(){
  if [ $# -ne 1 ]; then
    echo "Error: invalid argument"
    exit 1
  fi
  eval "_$1"
}

_common(){
  echo ".DS_Store" >>  .gitignore
  echo "*.swp" >>.gitignore
}

_java(){
  echo ".idea/" >>  .gitignore
  echo "*.iml" >>  .gitignore
  echo "*.ipr" >>  .gitignore
  echo "*.iws" >>  .gitignore
  echo "out/" >>  .gitignore
  echo "target/" >>  .gitignore
  echo ".project" >>  .gitignore
  echo ".classpath" >>  .gitignore

  _common
}

_ruby(){
  echo ".idea/" >> .gitignore
  echo ".bundle/" >> .gitignore
  echo "db/*.sqlite3" >> .gitignore
  echo "log/*.log" >> .gitignore
  echo "tmp/" >> .gitignore

  _common
}

git_init(){
  if [ -d .git ]; then
    echo "Error: git repository already exists"
    exit 1
  fi
  message="Init"
  [[ $# -gt 0 ]] && message=$1
  git init
  git add .
  git commit -m "$message"
  git log --oneline -1
}

html_init(){
  if [ $# -ne 1 ]; then
    echo "Error: invalid argument"
    exit 1
  fi
  echo "<!doctype html>" > $1
  echo "<html>" >> $1
  echo "<head>" >> $1
  echo "	<meta charset='UTF-8'>" >> $1
  echo "	<script type='text/javascript' src='jquery-1.8.0.min.js'></script>" >> $1
  echo "	<link type='text/css' rel='stylesheet' href='reset.css'>" >> $1
  echo "	<link rel='shortcut icon' href='favicon.ico'>" >> $1
  echo "</head>" >> $1
  echo "<body>" >> $1
  echo "</body>" >> $1
  echo "</html>" >> $1
	cp "${DEV_LIB_HOME}/jquery-1.8.0.min.js" .
	cp "${DEV_LIB_HOME}/reset.css" .
}

shell_init(){
  if [ $# -ne 1 ]; then
    echo "Error: invalid argument"
    exit 1
  fi
  echo "#!/bin/sh" > $1
  chmod +x $1
}

usage(){
  cat <<-EOF
Usage

Init commands:
  ignore    Init a .gitignore with a template
  git       Init a git repository and make a first commit
  html      Init a HTML file with link to jQuery and CSS reset
  sh|shell  Init a Shell script
EOF
}

if [ $# -eq 0 ]; then
  usage
  exit 1
fi

case $1 in
  ignore)
    shift
    ignore_init "$@"
    ;;
  git)
    shift
    git_init "$@"
    ;;
  html)
    shift
    html_init "$@"
    ;;
  sh|shell)
    shift
    shell_init "$@"
    ;;
  usage)
    usage
    ;;
  *)
    echo " Unsupported format."
    exit 1
    ;;
esac
